<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Davide - Registra transazione</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="form-container">
    <h1>ðŸ’¸ Davide - Registra transazione</h1>
    <form id="transaction-form">
      <div class="form-group">
        <label for="date">Data:</label>
        <input type="date" id="date" name="date" required>
      </div>

      <div class="form-group">
        <label for="amount">Importo:</label>
        <input type="number" id="amount" name="amount" step="0.01" min="0" inputmode="decimal" required>
      </div>

      <div class="form-group">
        <label for="category">Categoria:</label>
        <select id="category" name="category" required>
          <option value="">Seleziona una categoria</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="description">Descrizione:</label>
        <input type="text" id="description" name="description" autocomplete="off">
        <div id="suggestions" class="autocomplete-suggestions"></div>
      </div>

      <button type="submit" class="submit-button">Registra transazione</button>
      <p id="success-message" class="success-message" style="display:none;">Transazione registrata con successo!</p>
      <p id="error-message" class="error-message" style="display:none;">Si Ã¨ verificato un errore. Riprova.</p>
    </form>
  </div>

  <script>
    const suggestionsList = ["brioche", "pasticceria sirmione", "telepass", "satispay", "icloud", "estetista", "calza befana", "django gioco", "stampa lettera", "bar", "benzina", "merenda", "cookiebot", "rata auto", "integratori", "pagamento", "caffe", "iperal", "bytek", "mc", "autogrill", "focaccia", "mr dick", "ricarica tim", "carta credito", "colazione", "esselunga", "risparmio", "netflix", "piadina", "kart", "pizza", "sigarette", "polizza", "spotify", "maglione venduto", "pizzam", "sig e perdi", "zio pizza", "farmaci", "vapery", "parcheggio", "aruba", "regalo s valentino", "past verga", "chiacchiere", "wipstore 1", "coca", "sisal", "aperitivo", "caparra", "pizze", "cancelleria", "sigarette emotion", "tergi gio", "televisore", "spazzola piatti", "hotel", "pepco", "poke", "pane", "agenzia", "brita", "repcount app", "trenord", "pranzo", "rimborso casa gio", "tubo", "acido m", "fiori", "soundbar sonos", "acqua", "coin", "dominio sg davide", "ikea", "anello", "italmark", "bilancia cover", "scrivania ikea", "eremo", "molla", "cont deposito", "affitto cauzione", "spesina", "spesa", "gratta vinci", "prese", "rimborso gio", "rimborso deliveroo", "amazon adattatori", "pata", "aceto bicarbonato", "l'oreal x elena", "l'oreal x me", "marzo", "rimborso loreal", "mercato", "gelato", "braccio monitor", "biliardo", "tigota", "affitto", "portaposate", "coprimarer", "materasso cose", "eselunga", "svapo", "bollo titoli", "psicologa", "caffee", "cose casa amazon", "hamburger", "polpetteria", "asparagi", "assicurazione", "imac molteni", "tigota", "aliexpress intimo", "filtro cucina amazon", "amazon joystick", "gas enel", "affitto gio luglio", "tim casa", "14esima", "nen luce luglio", "soldi mamma in conto deposito", "abbonamento microsoft", "mobile deghi", "velcro adesivo", "spesina", "spiderman", "cookiebot", "webcam logitech", "booking napoli", "giovanni mese giugno+luglio", "gas enel", "affitto agosto", "luce agosto nen", "colazione", "svapo", "macfact", "mutande", "panta", "calliope", "granita", "lavaggio auto", "cascata delle marmore", "kebab", "svapo pod", "nonni regalo", "pareo gio", "diplomatico", "impermeabili", "regali vacanze", "decathlon", "caffe e pizzetta", "scarpe UA forge 96", "ikea besta", "titoli investimento", "titoli conto deposito", "filma", "noleggio film", "ikea pappa", "film donnie darko", "piadina deliveroo", "bottega verde", "cinesi", "oneblade papa", "affitto agosto", "tim casa luglio", "parcheggio aeroporto", "cinema", "cibo cinema"];

    // Precompilazione del campo data con la data corrente in formato GG/MM/AAAA
    document.getElementById('date').value = new Date().toLocaleDateString('it-IT');

    // Funzione per recuperare le categorie
    async function fetchCategories() {
      const response = await fetch('https://script.google.com/macros/s/AKfycbwVlGW7wL6r9-mwJJaNIbJMIYEBaYYzwRonV16vChh_gTr2npYMI9uANoC-06c0NTgy/exec?action=getCategories');
      const data = await response.json();
      const categorySelect = document.getElementById('category');
      data.categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);
      });
    }

    // Chiamata per recuperare le categorie all'apertura della pagina
    window.onload = fetchCategories;

    // Gestione della sottomissione del form
    document.getElementById('transaction-form').addEventListener('submit', async function(event) {
      event.preventDefault();
      const formData = new FormData(this);
      const data = Object.fromEntries(formData);

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbwVlGW7wL6r9-mwJJaNIbJMIYEBaYYzwRonV16vChh_gTr2npYMI9uANoC-06c0NTgy/exec', {
          method: 'POST',
          body: new URLSearchParams(data)
        });
        const result = await response.json();
        
        if (result.success) {
          document.getElementById('success-message').style.display = 'block';
          document.getElementById('error-message').style.display = 'none';
        } else {
          throw new Error(result.message);
        }
      } catch (error) {
        document.getElementById('error-message').textContent = error.message;
        document.getElementById('error-message').style.display = 'block';
      }
    });
  </script>
</body>
</html>
